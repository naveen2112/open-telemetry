{% extends 'layouts/base.html' %}

{% block title %}
    Update Sub Batch
{% endblock title %}

{% block header %}
    <div class="flex justify-between items-center">
        <div>
            <div class="text-dark-black text-lg mb-1 leading-none">
                Update Sub-Batch
            </div>
            <div class="text-dark-black-50 text-sm">

            </div>
        </div>
        <div class=" w-full flex justify-end items-center batch-btn">
            <a href="{% url 'batch.detail' batch_id %}"
                class="text-white bg-gray-500 rounded inline-flex items-center px-3 py-1 mr-6 text-base font-normal">
                <span class="text-xl mr-2">x</span>
                Cancel
            </a>
            <button type="submit"
                class="text-white bg-dark-blue rounded inline-flex items-center px-3 py-1 text-base font-normal"
                id="update_sub_batch">
                <span class="text-xl mr-2">+</span>
                Update Sub Batch
            </button>
        </div>
    </div>
{% endblock %}

{% block body %}
    <form method="post" enctype="multipart/form-data" id="sub_batch_form">
        {% csrf_token %}
        <div class="grid grid-cols-3 gap-210">
            <div class="form-field">
                {{ form.name|show_label }}
                {{ form.name }}
                {{ form.name|show_field_errors }}
            </div>
            <div class="work-basic-dropdown form-field">
                {{ form.team|show_label }}
                <div class="relative">
                    {{ form.team }}
                </div>
                {{ form.team|show_field_errors }}
            </div>
            <div class="form-field">
                {{ form.start_date|show_label }}
                {{ form.start_date }}
                {{ form.start_date|show_field_errors }}
            </div>
            <div class="work-basic-dropdown form-field">
                {{ form.timeline|show_label }}
                <div class="relative">
                    <div class="w-full block border border-primary-dark-30 mt-2.5 rounded-md focus:outline-none focus:ring-transparent focus:ring-offset-0 h-9 p-2 bg-transparent w-250"
                        id="timeline-name" style="
                                    position: absolute;
                                    top: -10px;
                                "></div>
                    {{ form.timeline }}
                </div>
                {{ form.timeline|show_field_errors }}
            </div>
            <div class="work-basic-dropdown form-field">
                {{ intern_detail.primary_mentor|show_label }}
                <div class="relative mt-2.5">
                    {{ intern_detail.primary_mentor }}
                </div>
                {{ intern_detail.primary_mentor|show_field_errors }}
            </div>
            <div class="work-basic-dropdown form-field">
                {{ intern_detail.secondary_mentor|show_label }}
                <div class="relative mt-2.5">
                    {{ intern_detail.secondary_mentor }}
                </div>
                {{ intern_detail.secondary_mentor|show_field_errors }}
            </div>
        </div>

    </form>
{% endblock %}

{% block script %}
    <script>
        $(document).ready(function () {
            $('#timeline-name').html('{{ sub_batch.timeline.name }}')
            $('#id_primary_mentor').val('{{ sub_batch_detail.primary_mentor.id }}')
            $('#id_secondary_mentor').val('{{ sub_batch_detail.secondary_mentor.id }}')
            $("#id_team").siblings().first().find("#show-value").text('{{ sub_batch.team.name }}')
            $("#id_primary_mentor").siblings().first().find("#show-value").text('{{ sub_batch_detail.primary_mentor.name }}')
            $("#id_secondary_mentor").siblings().first().find("#show-value").text('{{ sub_batch_detail.secondary_mentor.name }}')
        })

        $("#id_team").change(function () {
            $('.page-loader').show();
            $("#id_timeline").val("")
            $.ajax({
                type: "POST",
                url: "{% url 'sub-batch.team' %}",
                headers: { 'X-CSRFToken': $("[name=csrfmiddlewaretoken]").val() },
                data: {
                    team: $("#id_team").val()
                },
                success: function (data) {
                    $('.page-loader').hide();
                    $("#id_timeline").val(data.timeline.id)
                },
                error: function (xhr, status, error) {
                    $('.page-loader').hide();
                    alert(xhr.responseJSON.message)
                }
            });
        })

        $(document).ready(function () {
            function readURL(input) {
                if (input.files && input.files[0]) {
                    let fileName = input.files[0].name;
                    $('.file_input_name').show().html(fileName);
                    $('.file_input_text').hide();
                }
            }

            $("#file_upload").change(function () {
                readURL(this);
            });

            $(".remove-file").on("click", function () {
                $("#file_upload").val(null);
                $('.file_input_name').hide();
                $('.file_input_text').show();
            });
        });

        $(document).ready(function () {
            $('#update_sub_batch').click(function (e) {
                e.preventDefault();
                $('#sub_batch_form').submit();
            })
        });

        $(function () {
            var startDate = new Date('{{ sub_batch.start_date }}');
            $('input[name="start_date"]').daterangepicker({
                singleDatePicker: true,
                showDropdowns: true,
                minDate: startDate,
                locale: {
                    format: 'YYYY-MM-DD'
                }
            });
        });
    </script>
{% endblock %}